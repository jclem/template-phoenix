#!/bin/bash

set -e

module_name=$1
otp_app_name=$2

if [ -z "$module_name" ]; then
  echo "Usage: <module_name> <otp_app_name>"
  exit 1
fi

if [ -z "$otp_app_name" ]; then
  echo "Usage: $module_name <otp_app_name>"
  exit 1
fi

# Replace phoenix_template with $otp_app_name in all file or directory names.
find . -depth -name "*phoenix_template*" -execdir bash -c 'mv "$1" "${1//phoenix_template/$2}"' bash {} $otp_app_name \;

# Replace PhoenixTemplate with $module_name in all file contents.
find . -type f \
  -not -path "./.git/*" \
  -not -path "./deps/*" \
  -not -path "./_build/*" \
  -not -path "./.elixir_ls/*" \
  -not -path "./script/*" \
  -not -path "./priv/static/*" \
  -not -path "./assets/node_modules/*" \
  -exec sed -i '' -e "s/PhoenixTemplate/$module_name/g" {} \;

# Replace phoenix_template with $otp_app_name in all file contents.
find . -type f \
  -not -path "./.git/*" \
  -not -path "./deps/*" \
  -not -path "./_build/*" \
  -not -path "./.elixir_ls/*" \
  -not -path "./script/*" \
  -not -path "./priv/static/*" \
  -not -path "./assets/node_modules/*" \
  -exec sed -i '' -e "s/phoenix_template/$otp_app_name/g" {} \;